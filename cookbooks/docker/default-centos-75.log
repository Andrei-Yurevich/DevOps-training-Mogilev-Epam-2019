-----> Starting Kitchen (v1.24.0)
WARN: Unresolved specs during Gem::Specification.reset:
      bundler (>= 1.10)
WARN: Clearing out unresolved specs.
Please report a bug if this causes problems.
-----> Cleaning up any prior instances of <default-centos-75>
-----> Destroying <default-centos-75>...
       ==> default: Forcing shutdown of VM...
       ==> default: Destroying VM and associated drives...
       Vagrant instance <default-centos-75> destroyed.
       Finished destroying <default-centos-75> (0m5.11s).
-----> Testing <default-centos-75>
-----> Creating <default-centos-75>...
       Bringing machine 'default' up with 'virtualbox' provider...
       ==> default: Importing base box 'bento/centos-7.5'...
==> default: Matching MAC address for NAT networking...                                                 
       ==> default: Checking if box 'bento/centos-7.5' version '201808.24.0' is up to date...
       ==> default: Setting the name of the VM: kitchen-docker-default-centos-75
       ==> default: Clearing any previously set network interfaces...
       ==> default: Preparing network interfaces based on configuration...
           default: Adapter 1: nat
       ==> default: Forwarding ports...
           default: 22 (guest) => 2222 (host) (adapter 1)
       ==> default: Running 'pre-boot' VM customizations...
       ==> default: Booting VM...
       ==> default: Waiting for machine to boot. This may take a few minutes...
           default: SSH address: 127.0.0.1:2222
           default: SSH username: vagrant
           default: SSH auth method: private key
           default: Warning: Remote connection disconnect. Retrying...
           default: 
           default: Vagrant insecure key detected. Vagrant will automatically replace
           default: this with a newly generated keypair for better security.
           default: 
           default: Inserting generated public key within guest...
           default: Removing insecure key from the guest if it's present...
           default: Key inserted! Disconnecting and reconnecting using new SSH key...
       ==> default: Machine booted and ready!
       ==> default: Checking for guest additions in VM...
           default: The guest additions on this VM do not match the installed version of
           default: VirtualBox! In most cases this is fine, but in rare cases it can
           default: prevent things such as shared folders from working properly. If you see
           default: shared folder errors, please make sure the guest additions within the
           default: virtual machine match the version of VirtualBox you have installed on
           default: your host and reload your VM.
           default: 
           default: Guest Additions Version: 5.2.18
           default: VirtualBox Version: 6.0
       ==> default: Setting hostname...
       ==> default: Mounting shared folders...
           default: /tmp/omnibus/cache => /home/andrey/.kitchen/cache
       ==> default: Machine not provisioned because `--no-provision` is specified.
       [SSH] Established
       Vagrant instance <default-centos-75> created.
       Finished creating <default-centos-75> (0m43.96s).
-----> Converging <default-centos-75>...
       Preparing files for transfer
       Preparing dna.json
       Resolving cookbook dependencies with Berkshelf 7.0.7...
       Removing non-cookbook files before transfer
       Preparing nodes
       Preparing validation.pem
       Preparing client.rb
-----> Installing Chef install only if missing package
       Downloading https://omnitruck.chef.io/install.sh to file /tmp/install.sh
       Trying wget...
       Download complete.
       el 7 x86_64
       Getting information for chef stable  for el...
       downloading https://omnitruck.chef.io/stable/chef/metadata?v=&p=el&pv=7&m=x86_64
         to file /tmp/install.sh.2990/metadata.txt
       trying wget...
       sha1     8861da401e22eec58fe1565b314968fff73e03a9
       sha256   633f211df89e1483341afb35230a29589e1a51e0f5f91fea5594a90d734a8c78
       url      https://packages.chef.io/files/stable/chef/14.11.21/el/7/chef-14.11.21-1.el7.x86_64.rpm
       version  14.11.21
       downloaded metadata file looks valid...
       /tmp/omnibus/cache/chef-14.11.21-1.el7.x86_64.rpm exists
       Comparing checksum with sha256sum...
       
       WARNING WARNING WARNING WARNING WARNING WARNING WARNING WARNING WARNING
       
       You are installing an omnibus package without a version pin.  If you are installing
       on production servers via an automated process this is DANGEROUS and you will
       be upgraded without warning on new releases, even to new major releases.
       Letting the version float is only appropriate in desktop, test, development or
       CI/CD environments.
       
       WARNING WARNING WARNING WARNING WARNING WARNING WARNING WARNING WARNING
       
       Installing chef 
       installing with rpm...
       warning: /tmp/omnibus/cache/chef-14.11.21-1.el7.x86_64.rpm: Header V4 DSA/SHA1 Signature, key ID 83ef826a: NOKEY                                                                                         
       Preparing...                          ################################# [100%]
       Updating / installing...
          1:chef-14.11.21-1.el7              ################################# [100%]
       Thank you for installing Chef!
       Transferring files to <default-centos-75>
       Starting Chef Client, version 14.11.21
       Creating a new client identity for default-centos-75 using the validator key.
       resolving cookbooks for run list: ["docker::default"]
       Synchronizing Cookbooks:
         - docker (0.1.0)
       Installing Cookbook Gems:
       Compiling Cookbooks...
       Converging 5 resources
       Recipe: docker::default
         * execute[yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo] action run                                                                                            
           - execute yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo                                                                                                      
         * yum_package[yum-utils, device-mapper-persistent-data, curl, lvm2] action install (up to date)
         * yum_package[docker-ce, docker-ce-cli, containerd.io] action install
           - install version 3:18.09.3-3.el7.x86_64 of package docker-ce
           - install version 1:18.09.3-3.el7.x86_64 of package docker-ce-cli
           - install version 0:1.2.4-3.1.el7.x86_64 of package containerd.io
         * service[docker] action start
           - start service service[docker]
         * service[docker] action enable
           - enable service service[docker]
         * template[/etc/docker/deamon.json] action create
           - create new file /etc/docker/deamon.json
           - update content in file /etc/docker/deamon.json from none to 5e1e61
           --- /etc/docker/deamon.json  2019-03-21 09:21:17.780815217 +0000
           +++ /etc/docker/.chef-deamon20190321-3116-139esgv.json       2019-03-21 09:21:17.780815217 +0000                                                                                                     
           @@ -1 +1,5 @@
           +{
           +    "insecure-registries" : [ "10.0.0.254:5000" ]
           +}
           +
           - restore selinux security context
         * service[docker] action restart
           - restart service service[docker]
       
       Running handlers:
       Running handlers complete
       Chef Client finished, 6/7 resources updated in 01 minutes 51 seconds
       Downloading files from <default-centos-75>
       Finished converging <default-centos-75> (2m3.66s).
-----> Setting up <default-centos-75>...
       Finished setting up <default-centos-75> (0m0.00s).
-----> Verifying <default-centos-75>...
       Detected alternative framework tests for `inspec`
       Loaded tests from {:path=>".home.work.vagrant.DevOps-training-Mogilev-Epam-2019.cookbooks.docker.test.integration.default.inspec"}                                                                       
       Loaded tests from {:path=>".home.work.vagrant.DevOps-training-Mogilev-Epam-2019.cookbooks.docker.test.integration.default"}                                                                              

Profile: tests from {:path=>"/home/work/vagrant/DevOps-training-Mogilev-Epam-2019/cookbooks/docker/test/integration/default/inspec"} (tests from {:path=>".home.work.vagrant.DevOps-training-Mogilev-Epam-2019.cookbooks.docker.test.integration.default.inspec"})
Version: (not specified)
Target:  ssh://vagrant@127.0.0.1:2222

  Port 80
     ✔  should not be listening
  System Package docker-ce
     ✔  should be installed
  File /etc/docker/deamon.json
     ✔  should exist
     ✔  content should match /insecure-registries/

Profile: tests from {:path=>"/home/work/vagrant/DevOps-training-Mogilev-Epam-2019/cookbooks/docker/test/integration/default"} (tests from {:path=>".home.work.vagrant.DevOps-training-Mogilev-Epam-2019.cookbooks.docker.test.integration.default"})
Version: (not specified)
Target:  ssh://vagrant@127.0.0.1:2222

  Port 80
     ✔  should not be listening
  System Package docker-ce
     ✔  should be installed
  File /etc/docker/deamon.json
     ✔  should exist
     ✔  content should match /insecure-registries/

Test Summary: 8 successful, 0 failures, 0 skipped
       Finished verifying <default-centos-75> (0m2.04s).
-----> Destroying <default-centos-75>...
       ==> default: Forcing shutdown of VM...
       ==> default: Destroying VM and associated drives...
       Vagrant instance <default-centos-75> destroyed.
       Finished destroying <default-centos-75> (0m4.77s).
       Finished testing <default-centos-75> (2m59.56s).
-----> Kitchen is finished. (3m4.87s)
